window.ES=window.ES||{},ES.Global=function(e){var t,n,i,a=sessionStorage;return e.database={},n=function(){Array.prototype.mergeArray=function(e){var t=this.concat(e),n={};return t=t.filter(function(e){return!n.hasOwnProperty(e)&&(n[e]=!0)})},Array.prototype.difference=function(e){return this.filter(function(t){return e.indexOf(t)===-1})}},t=function(){$("body").off("click.showCalendar",".calendar .glyphicon-calendar").on("click.showCalendar",".calendar .glyphicon-calendar",function(){$(this).closest(".calendar").find("input").trigger("focus")})},i=function(){var t;try{t=a.getItem("eventScheduler"),t=JSON.parse(t),t&&(e.database=t)}catch(t){e.database={}}},e.updateStorage=function(){var t=JSON.stringify(e.database);try{a.setItem("eventScheduler",t)}catch(e){}},e.initDatePicker=function(){$("#main-content .calendar input").datetimepicker({format:"MM/DD/YYYY",ignoreReadonly:!0,minDate:new Date,useCurrent:!0,daysOfWeekDisabled:[0,6]})},e.getTemplate=function(e){var t;return $.ajax({url:e,async:!1,success:function(e){t=e},error:function(){t=null}}),Handlebars.compile(t)},e.enable=function(){n(),i(),t()},e}({}),ES.Global.enable(),ES.Home=function(e){var t,n,i={};return _initDomCaching=function(){i.navTabs=$("nav .tab-list"),i.resultView=$("#main-content")},t=function(){i.navTabs.off("click.changeTab").on("click.changeTab","li",function(){n($(this))})},n=function(e){var t=e.data("identifier");i.navTabs.find("li").removeClass("active"),e.addClass("active"),i.resultView.find("section").addClass("hidden"),i.resultView.find("#"+t).removeClass("hidden"),ES.List.enable(),ES.Create.enable()},e.enable=function(){_initDomCaching(),t()},e}({}),ES.Home.enable(),ES.Create=function(e){var t,n,i,a,r,l,o,c,s,f,d,u={},v=ES.Global.getTemplate("/templates/task.html"),g=["9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00"];return t=function(){u.create=$("#create"),u.createEventForm=u.create.find("form"),u.navTabs=$("nav .tab-list"),u.eventType=u.create.find("#eventType"),u.resultView=u.create.find(".result-view")},n=function(){u.eventType.off("change.eventType").on("change.eventType",function(){a($(this))}),u.resultView.off("change.time").on("change.time",".js-time #from",function(){_changeTimeSlot($(this))}),u.resultView.off("click.addTask").on("click.addTask",".add-task",function(){c()}),u.resultView.off("click.removeTask").on("click.removeTask",".remove-task",function(){s()}),u.createEventForm.off("submit.createEvent").on("submit.createEvent",function(e){e.preventDefault();var t=r($(this));t.bookedTimeSlot=l(t.from,t.to),o(t),ES.List.gotoState()}),u.resultView.off("dp.change").on("dp.change",".calendar input",function(){var e=d($(this));f(e)})},d=function(e){var t=ES.Global.database,n=e.val(),i=t[n]?t[n].length:0,a=[];if(i){for(var r=0;r<i;r++)t[n][r].bookedTimeSlot&&(a=a.mergeArray(t[n][r].bookedTimeSlot));return g.difference(a)}return g},i=function(e,t){var n=t.length;e.empty();for(var i=0;i<n;i++)e.append($("<option>",{value:t[i],text:t[i]}))},f=function(e){var t=_makeCopy(e);t.splice(t.length-1,1),i(u.resultView.find(".js-time #from"),t),u.resultView.find(".js-time #from").trigger("change")},_changeTimeSlot=function(e){for(var t=e.val(),n=d(u.resultView.find(".calendar input")),a=[],r=n.indexOf(t),l=g.indexOf(t),o=n.length-r>9?9:n.length-r,c=1;c<o&&n[r+c]===g[l+c];c++)a.push(n[r+c]);!a.length&&e.closest("form").find("#to").length?e.closest("form").find('button[type="submit"]').addClass("disabled"):e.closest("form").find('button[type="submit"]').removeClass("disabled"),i(u.resultView.find(".js-time #to"),a)},a=function(e,t){var n,i=e.val(),a="/templates/";n=ES.Global.getTemplate(a+i+".html"),u.resultView.html(n({data:t})),ES.Global.initDatePicker(),u.resultView.find(".calendar input").trigger("dp.change")},r=function(e){var t,n,i,a,r,l=e.find("#date").val(),o=e.find("#from").val(),c=[];if(i=new Date(l+" "+o),n=i.getTime(),e.find(".task-container").length){a=e.find(".task-container .task input"),r=a.length;for(var s=0;s<r;s++)a.eq(s).val()&&c.push({title:a.eq(s).val(),id:s+1})}else c=null;return t={type:e.find("#eventType").val(),title:e.find("#title").val(),location:e.find("#location").val(),invitees:e.find("#invitees").val(),date:l,from:o,to:e.find("#to").val(),description:e.find("#desc").val(),reminderTime:n,tasks:c}},l=function(e,t){var n=_makeCopy(g);if(e&&t)return n.slice(n.indexOf(e),n.indexOf(t))},o=function(e){var t=ES.Global.database;t.hasOwnProperty(e.date)||(t[e.date]=[]),t[e.date].push(e),ES.Global.updateStorage()},_makeCopy=function(e){return JSON.parse(JSON.stringify(e))},c=function(){var e,t=u.resultView.find(".task-container .task").length;e={id:"task"+t,title:"Task "+(t+1)},u.resultView.find(".task-container").append(v(e))},s=function(){u.resultView.find(".task-container .task").last().remove()},e.gotoState=function(e){u.eventType.val(e.type),u.navTabs.find('li[data-identifier="create"]').trigger("click"),a(u.eventType,e)},e.enable=function(){t(),n(),u.eventType.trigger("change")},e}({}),ES.Create.enable(),ES.List=function(e){var t,n,i,a,r,l,o,c,s={};return t=function(){s.list=$("#list"),s.navTabs=$("nav .tab-list"),s.eventListing=s.list.find(".event-listing"),s.gridView=s.eventListing.find(".grid-view"),s.selectDate=s.list.find("#selectDate")},n=function(){s.selectDate.off("dp.change").on("dp.change",function(e){var t=i($(this));c($(this),t)}),s.gridView.off("click.delete","article .delete").on("click.delete","article .delete",function(e){a($(this))}),s.gridView.off("click.edit","article .edit").on("click.edit","article .edit",function(e){l($(this))}),s.gridView.off("click.taskStatus").on("click.taskStatus",'.task-list input[type="radio"]',function(){o($(this))})},i=function(e){var t=e.val(),n=ES.Global.database;return n&&n[t]?n[t]:null},r=function(e,t){var n=i(t),a=n?n.length:0;if(n&&a){for(var r=0;r<a&&e!==n[r].type+n[r].reminderTime;r++);return r!==a?n[r]:null}},c=function(e,t){var n=e.val(),i=ES.Global.getTemplate("/templates/eventGrid.html");s.eventListing.find("h2").html("Events on "+n),t&&t.length?(t=t.sort(function(e,t){return e.reminderTime-t.reminderTime}),s.gridView.html(i({data:t}))):s.gridView.html($("<div>",{class:"no-result col-xs-12 col-md-12",text:"No Events are scheduled for this date!"}))},a=function(e){var t,n=e.closest("article"),a=n.data("identifier"),l=i(s.selectDate);t=r(a,s.selectDate),t&&(l.splice(l.indexOf(t),1),s.selectDate.trigger("dp.change"),ES.Global.updateStorage())},l=function(e){var t,n=e.closest("article"),i=n.data("identifier");t=r(i,s.selectDate),t&&(a(e),ES.Create.gotoState(t))},o=function(e){var t=e.closest("li"),n=e.val();t.attr("class",n)},e.gotoState=function(){s.navTabs.find('li[data-identifier="list"]').trigger("click")},e.enable=function(){t(),n(),s.selectDate.trigger("dp.change")},e}({}),ES.List.enable();